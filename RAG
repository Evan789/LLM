RAG çš„ä»£ç å®ç°æµç¨‹

1. æ•°æ®å‡†å¤‡ & å‘é‡åŒ–

æ”¶é›†ä½ çš„æ–‡æ¡£ï¼ˆPDFã€ç½‘é¡µã€æ•°æ®åº“è®°å½•ç­‰ï¼‰ã€‚

ä½¿ç”¨ embedding æ¨¡å‹ï¼ˆå¦‚ OpenAI Embeddingsã€Sentence-BERTï¼‰æŠŠæ–‡æ¡£åˆ‡åˆ†æˆç‰‡æ®µï¼Œå¹¶è½¬åŒ–ä¸ºå‘é‡ã€‚

æŠŠè¿™äº›å‘é‡å­˜å…¥ä¸€ä¸ª å‘é‡æ•°æ®åº“ï¼ˆå¦‚ Pineconeã€FAISSã€Weaviateï¼‰ã€‚
------
from openai import OpenAI
import faiss
import numpy as np

client = OpenAI()

# ç¤ºä¾‹æ–‡æ¡£
docs = ["å®é©¬å‘å¸ƒäº†æœ€æ–° recall...", "RAG æ˜¯ä¸€ç§å¢å¼ºç”Ÿæˆæ¨¡å‹çš„æ¶æ„..."]

# è·å–å‘é‡
embeddings = [client.embeddings.create(model="text-embedding-ada-002", input=doc).data[0].embedding for doc in docs]

# å­˜å…¥å‘é‡åº“ (FAISS)
dim = len(embeddings[0])
index = faiss.IndexFlatL2(dim)
index.add(np.array(embeddings).astype('float32'))
------

2. ç”¨æˆ·è¾“å…¥æŸ¥è¯¢

ç”¨æˆ·æå‡ºé—®é¢˜ï¼ŒæŠŠé—®é¢˜è½¬åŒ–ä¸ºå‘é‡ embeddingã€‚

åœ¨å‘é‡åº“ä¸­æ£€ç´¢æœ€ç›¸å…³çš„æ–‡æ¡£ã€‚

------
query = "å®é©¬ recall ä¸€èˆ¬æ¶‰åŠå“ªäº›æ›´æ–°ï¼Ÿ"
query_vec = client.embeddings.create(model="text-embedding-ada-002", input=query).data[0].embedding

# æ£€ç´¢å‰2ä¸ªæœ€ç›¸ä¼¼æ–‡æ¡£
D, I = index.search(np.array([query_vec]).astype('float32'), k=2)
retrieved_docs = [docs[i] for i in I[0]]
------


3. ç»„åˆä¸Šä¸‹æ–‡ & è°ƒç”¨LLM

æŠŠç”¨æˆ·é—®é¢˜å’Œæ£€ç´¢åˆ°çš„æ–‡æ¡£æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œä½œä¸º LLM çš„è¾“å…¥ã€‚
------
context = "\n".join(retrieved_docs)
prompt = f"å·²çŸ¥ä¿¡æ¯ï¼š{context}\n\nè¯·å›ç­”ç”¨æˆ·é—®é¢˜ï¼š{query}"

response = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[{"role": "user", "content": prompt}]
)

print(response.choices[0].message.content)
------

4. è¾“å‡ºç»“æœ

LLM åŸºäºæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ç”Ÿæˆç­”æ¡ˆã€‚

ç­”æ¡ˆæ—¢ç»“åˆäº†å¤§æ¨¡å‹çš„è¯­è¨€èƒ½åŠ›ï¼Œä¹Ÿåˆ©ç”¨äº†å¤–éƒ¨çŸ¥è¯†ã€‚

ğŸ”¹ æ€»ç»“

ä»£ç å®ç° RAG çš„å¤§è‡´æ­¥éª¤æ˜¯ï¼š

å‡†å¤‡æ•°æ® â†’ å»ºç«‹å‘é‡åº“

ç”¨æˆ·è¾“å…¥ â†’ è½¬ embedding

å‘é‡æ£€ç´¢ â†’ æ‰¾ç›¸å…³æ–‡æ¡£

æ‹¼æ¥ä¸Šä¸‹æ–‡ â†’ è°ƒç”¨LLMç”Ÿæˆç­”æ¡ˆ

----------------------------------------
Distancesï¼ˆè·ç¦»ï¼‰ æˆ– ç›¸ä¼¼åº¦åˆ†æ•°

è¡¨ç¤ºæŸ¥è¯¢å‘é‡å’Œåº“ä¸­å‘é‡ä¹‹é—´çš„â€œæ¥è¿‘ç¨‹åº¦â€ã€‚

æ•°å€¼è¶Šå°ï¼ˆæ¬§å¼è·ç¦» L2ï¼‰æˆ–è¶Šå¤§ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰ï¼Œè¯´æ˜è¶Šç›¸å…³ã€‚

D = ç›¸ä¼¼åº¦/è·ç¦»åˆ†æ•°

I = å‘½ä¸­çš„æ–‡æ¡£ç´¢å¼•

ç¡®å® docs é‡Œæœ‰ 3 ä¸ªå…ƒç´ ï¼Œä½†è¿”å›çš„ D å’Œ I åªæœ‰ 2 ä¸ªï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è°ƒç”¨ index.search() çš„æ—¶å€™å†™äº†ï¼š

D, I = index.search(query_vec, k=2)


è¿™é‡Œçš„ k=2 å°±å†³å®šäº†ï¼š
ğŸ‘‰ åªè¿”å›æœ€ç›¸å…³çš„ 2 ä¸ªæ–‡æ¡£ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ–‡æ¡£ã€‚
-------------------------------------

å‡è®¾æœ‰ 3 ç¯‡æ–‡æ¡£ï¼š

docs = [
  "å®é©¬ recall æ›´æ–°ç”µæ± ç®¡ç†ç³»ç»Ÿ",   # index 0
  "RAG æ˜¯æ£€ç´¢å¢å¼ºç”Ÿæˆ",             # index 1
  "å®é©¬å‘å¸ƒè½¯ä»¶å‡çº§"                 # index 2
]


ç”¨æˆ·é—®ï¼šâ€œå®é©¬ recall ä¸€èˆ¬æ›´æ–°ä»€ä¹ˆï¼Ÿâ€

å‡è®¾ç›¸ä¼¼åº¦è®¡ç®—ç»“æœæ˜¯ï¼š

æ–‡æ¡£ index	æ–‡æ¡£å†…å®¹	ç›¸ä¼¼åº¦ï¼ˆä½™å¼¦åˆ†æ•°ï¼‰
0	å®é©¬ recall æ›´æ–°ç”µæ± ç®¡ç†ç³»ç»Ÿ	0.95
1	RAG æ˜¯æ£€ç´¢å¢å¼ºç”Ÿæˆ	0.10
2	å®é©¬å‘å¸ƒè½¯ä»¶å‡çº§	0.85

å¦‚æœ k=2ï¼Œç³»ç»Ÿåªè¿”å›æœ€ç›¸å…³çš„ä¸¤ä¸ªï¼š

D = [[0.95, 0.85]]
I = [[0, 2]]


å¯¹åº”çš„æ˜¯ï¼š

ç¬¬ 0 ä¸ªæ–‡æ¡£ï¼ˆæœ€ç›¸å…³ï¼‰

ç¬¬ 2 ä¸ªæ–‡æ¡£ï¼ˆç¬¬äºŒç›¸å…³ï¼‰

å¦‚æœæ”¹æˆ k=3

é‚£ä¹ˆä¼šåŒ…å«å…¨éƒ¨ 3 ç¯‡ï¼š

D = [[0.95, 0.85, 0.10]]
I = [[0, 2, 1]]


è¿™æ ·ä½ å°±èƒ½çœ‹åˆ°æ‰€æœ‰æ–‡æ¡£çš„ç›¸å…³æ€§ã€‚
